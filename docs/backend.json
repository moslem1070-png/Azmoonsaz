{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Persian QuizMaster application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, matching the Firebase Auth UID."
        },
        "role": {
          "type": "string",
          "description": "The role of the user (e.g., 'teacher', 'student')."
        },
        "nationalId": {
          "type": "string",
          "description": "The user's national ID (for students) or username (for teachers)."
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        }
      },
      "required": [
        "id",
        "role",
        "nationalId",
        "firstName",
        "lastName"
      ]
    },
    "Exam": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Exam",
      "type": "object",
      "description": "Represents an exam in the Persian QuizMaster application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Exam entity."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher's UID. (Relationship: Teacher 1:N Exam)"
        },
        "title": {
          "type": "string",
          "description": "The title of the exam."
        },
        "coverImageURL": {
          "type": "string",
          "description": "URL of the cover image for the exam.",
          "format": "uri"
        },
        "difficulty": {
          "type": "string",
          "description": "The difficulty level of the exam (e.g., 'Easy', 'Medium', 'Hard')."
        },
        "timer": {
          "type": "number",
          "description": "The time limit for the exam, in minutes."
        }
      },
      "required": [
        "id",
        "teacherId",
        "title",
        "difficulty",
        "timer"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a question in an exam.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Question entity."
        },
        "examId": {
          "type": "string",
          "description": "Reference to Exam. (Relationship: Exam 1:N Question)"
        },
        "text": {
          "type": "string",
          "description": "The text of the question."
        },
        "imageURL": {
          "type": "string",
          "description": "URL of the image for the question (optional).",
          "format": "uri"
        },
        "correctAnswer": {
          "type": "string",
          "description": "The correct answer for the question."
        },
        "options": {
          "type": "array",
          "description": "The options for the question.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "examId",
        "text",
        "correctAnswer",
        "options"
      ]
    },
    "ExamResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExamResult",
      "type": "object",
      "description": "Represents the results of a student taking an exam.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ExamResult entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student's UID. (Relationship: Student 1:N ExamResult)"
        },
        "examId": {
          "type": "string",
          "description": "Reference to Exam. (Relationship: Exam 1:N ExamResult)"
        },
        "scorePercentage": {
          "type": "number",
          "description": "The student's score as a percentage (0-100)."
        },
        "correctness": {
          "type": "number",
          "description": "The number of questions answered correctly."
        },
        "submissionTime": {
          "type": "string",
          "description": "The date and time when the exam was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "studentId",
        "examId",
        "scorePercentage",
        "correctness",
        "submissionTime"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The document ID is the Firebase Auth UID. This ensures that only the authenticated user can access their profile, enforcing ownership via path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user (matches Firebase Auth UID)."
            }
          ]
        }
      },
      {
        "path": "/exams/{examId}",
        "definition": {
          "entityName": "Exam",
          "schema": {
            "$ref": "#/backend/entities/Exam"
          },
          "description": "Stores all exams in a top-level collection. This allows public read access for all authenticated users (students browsing exams), while write access is restricted to teachers.",
          "params": [
            {
              "name": "examId",
              "description": "The unique ID of the exam."
            }
          ]
        }
      },
      {
        "path": "/exams/{examId}/questions/{questionId}",
        "definition": {
          "entityName": "Question",
          "schema": {
            "$ref": "#/backend/entities/Question"
          },
          "description": "Stores questions for a specific exam as a subcollection. Permissions are inherited from the parent exam.",
          "params": [
            {
              "name": "examId",
              "description": "The unique ID of the exam."
            },
            {
              "name": "questionId",
              "description": "The unique ID of the question."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/examResults/{examResultId}",
        "definition": {
          "entityName": "ExamResult",
          "schema": {
            "$ref": "#/backend/entities/ExamResult"
          },
          "description": "Stores private exam results for each student. Path-based ownership ensures that only the student themselves can access their results.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the student (user)."
            },
            {
              "name": "examResultId",
              "description": "The unique ID of the exam result."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed for security and scalability. User data is keyed by the Auth UID for strong ownership (`/users/{userId}`). Exam results are a subcollection of the user, inheriting this ownership. Exams are in a top-level collection (`/exams`) to allow global read access for all authenticated users, with writes restricted by security rules to 'teacher' roles. This avoids complex cross-document reads in security rules and ensures a clear, secure data model."
  }
}
